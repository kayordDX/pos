SELECT 
	a.payment_type_name,
  a.amount,
  b.amount::integer avgAmount
FROM (
SELECT 
	pt.payment_type_name,
  SUM(p.amount) amount
FROM payment p
JOIN payment_type pt 
	ON p.payment_type_id = pt.payment_type_id
JOIN table_booking tb 
  ON tb.id = p.table_booking_id
JOIN sales_period sp 
  ON tb.sales_period_id = sp.id
WHERE tb.sales_period_id = 1040
 AND sp.outlet_id = 1
GROUP BY pt.payment_type_name
) a
JOIN (
SELECT 
	pt.payment_type_name,
  AVG(p.amount) amount
FROM payment p
JOIN payment_type pt 
	ON p.payment_type_id = pt.payment_type_id
JOIN table_booking tb 
  ON tb.id = p.table_booking_id
JOIN sales_period sp 
  ON tb.sales_period_id = sp.id
WHERE tb.sales_period_id IN (select id from sales_period where outlet_id = 1 order by id desc limit 5)
 AND sp.outlet_id = 1
GROUP BY pt.payment_type_name
) b
ON a.payment_type_name = b.payment_type_name